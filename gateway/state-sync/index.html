
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../disk-usage/">
      
      
        <link rel="next" href="../mempool/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>state-sync - DAODST document</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#state-synchronization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DAODST document" class="md-header__button md-logo" aria-label="DAODST document" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DAODST document
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              state-sync
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="https://zh-tw.docs.daodst.com" hreflang="zh" class="md-select__link">
              ‰∏≠Êñá
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="https://docs.daodst.com" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../protocol/stcd/" class="md-tabs__link">
          
  
  üîçProtocol

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules_accounts/" class="md-tabs__link">
          
  
  üß±Module

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../run/" class="md-tabs__link">
          
  
  üè∞Gateways and Authenticators

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../chat/installation/" class="md-tabs__link">
          
  
  üìûChat

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../window/introduce/" class="md-tabs__link">
          
  
  ‚úàCross-chain

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
    
  
  üìãFAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DAODST document" class="md-nav__button md-logo" aria-label="DAODST document" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DAODST document
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üîçProtocol
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            üîçProtocol
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            Command Line Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/single-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single-node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI command
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/account/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    account
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/chainid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chain ID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/encode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    encode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/gas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gas and fees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/keyring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    keyring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/key-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Key Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/state-migrate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State import and export
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/pending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    waiting queue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/multsign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multsignature
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/coin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    token
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/transfer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transfer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üß±Module
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üß±Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules_accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module Accounts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../evm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mgateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../contract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contract
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pledge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pledge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../bank/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bank
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gov/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gov
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../distribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../slashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slashing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../staking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üè∞Gateways and Authenticators
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üè∞Gateways and Authenticators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Settings and configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Settings and configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Validator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../disk-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disk usage optimization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    state-sync
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    state-sync
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tendermint-core-state-synchronization" class="md-nav__link">
    Tendermint core state synchronization
  </a>
  
    <nav class="md-nav" aria-label="Tendermint core state synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-synchronization-snapshot" class="md-nav__link">
    State synchronization snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#take-and-provide-snapshots" class="md-nav__link">
    Take and provide snapshots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-snapshot" class="md-nav__link">
    restore snapshot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cosmos-sdk-state-synchronization" class="md-nav__link">
    Cosmos SDK state synchronization
  </a>
  
    <nav class="md-nav" aria-label="Cosmos SDK state synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-synchronization-snapshot_1" class="md-nav__link">
    State synchronization snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-state-sync-snapshot" class="md-nav__link">
    Enable state sync snapshot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-synchronization-node" class="md-nav__link">
    State synchronization node
  </a>
  
    <nav class="md-nav" aria-label="State synchronization node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-the-system" class="md-nav__link">
    Prepare the system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-following-commands-for-mainnet-settings" class="md-nav__link">
    Use the following commands for mainnet settings
  </a>
  
    <nav class="md-nav" aria-label="Use the following commands for mainnet settings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-stcd" class="md-nav__link">
    Install stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-stcd-service" class="md-nav__link">
    Create stcd service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-stcd" class="md-nav__link">
    Run stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-logs" class="md-nav__link">
    Check logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turn-off-state-synchronization-mode" class="md-nav__link">
    Turn off state synchronization mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mempool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mempool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../key-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Key Backup Restore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Checklist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../safe-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentinel Nodes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    upgrade
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            upgrade
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade List
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/hard-fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hard Fork Upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/auto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auto Upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/manual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/rollback/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rollback
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proposal Template
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../testnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    testnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mainnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mainnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gateway Operation Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Gateway Operation Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../guide-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operation Guide(linux)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../guide-win/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operation Guide(win)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../key-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Key backup and recovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ttts/ttts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Translation&Text-to-Speech
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    üìûChat
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üìûChat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/chat_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/customise_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/voip_signaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Call flow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/optional_cfg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optional Configuration*
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    ‚úàCross-chain
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            ‚úàCross-chain
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cross-chain desktop program for sellers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Cross-chain desktop program for sellers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../window/introduce/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduce
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../window/info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instructions for use
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìãFAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tendermint-core-state-synchronization" class="md-nav__link">
    Tendermint core state synchronization
  </a>
  
    <nav class="md-nav" aria-label="Tendermint core state synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-synchronization-snapshot" class="md-nav__link">
    State synchronization snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#take-and-provide-snapshots" class="md-nav__link">
    Take and provide snapshots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-snapshot" class="md-nav__link">
    restore snapshot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cosmos-sdk-state-synchronization" class="md-nav__link">
    Cosmos SDK state synchronization
  </a>
  
    <nav class="md-nav" aria-label="Cosmos SDK state synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-synchronization-snapshot_1" class="md-nav__link">
    State synchronization snapshot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-state-sync-snapshot" class="md-nav__link">
    Enable state sync snapshot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-synchronization-node" class="md-nav__link">
    State synchronization node
  </a>
  
    <nav class="md-nav" aria-label="State synchronization node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-the-system" class="md-nav__link">
    Prepare the system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-following-commands-for-mainnet-settings" class="md-nav__link">
    Use the following commands for mainnet settings
  </a>
  
    <nav class="md-nav" aria-label="Use the following commands for mainnet settings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-stcd" class="md-nav__link">
    Install stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-stcd-service" class="md-nav__link">
    Create stcd service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-stcd" class="md-nav__link">
    Run stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-logs" class="md-nav__link">
    Check logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turn-off-state-synchronization-mode" class="md-nav__link">
    Turn off state synchronization mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="state-synchronization">state synchronization</h1>
<p>Learn about Tendermint Core state synchronization and support provided by the Cosmos SDK.</p>
<p>üì£ Tip: Just concerned about how to sync nodes with the network? Skip to <a href="#_8">this section</a>.</p>
<h2 id="tendermint-core-state-synchronization">Tendermint core state synchronization</h2>
<p>State synchronization allows new nodes to join the network by taking a snapshot of the most recent state of the network, rather than fetching and replaying all historical blocks.
Since the application state is smaller than all blocks combined, and restoring state is faster than replaying blocks, this reduces the time to sync with the network from days to minutes.</p>
<p>This part of the document provides a brief overview of the Tendermint state synchronization protocol, and how nodes are synchronized.
For more details, see the <a href="https://docs.tendermint.com/master/spec/abci/apps.html#state-sync">ABCI Application Guide</a> and the <a href="https://docs .tendermint.com/master/spec/abci/abci.html">ABCI Reference Documentation</a>.</p>
<h3 id="state-synchronization-snapshot">State synchronization snapshot</h3>
<p>A guiding principle when designing Tendermint state synchronization is to provide as much flexibility as possible for applications. Therefore, Tendermint doesn't care what the snapshots contain, how they were taken or how they were restored. It is only concerned with discovering existing snapshots in the network, fetching them and passing them to the application via ABCI.</p>
<p>Tendermint uses light client validation to check the final application hash of the restored application against the chain application hash, but any further validation must be done by the application itself during recovery.</p>
<p>Snapshots consist of binary blocks of arbitrary format. Chunks cannot be larger than 16 MB, otherwise there is no limit.
<a href="https://docs.tendermint.com/master/spec/abci/abci.html#snapshot">Snapshot Metadata</a>, exchanged via ABCI and P2P, contains the following fields:</p>
<ul>
<li><code>height</code> (<code>uint64</code>): The height at which the snapshot was taken</li>
<li><code>format</code> (<code>uint32</code>): Arbitrary application-specific format identifier (e.g. version)</li>
<li><code>chunks</code> (<code>uint32</code>): number of binary chunks in the snapshot</li>
<li><code>hash</code> (<code>bytes</code>): Arbitrary snapshot hash for comparing snapshots across nodes</li>
<li><code>metadata</code> (<code>bytes</code>): Arbitrary binary snapshot metadata for use by the application</li>
</ul>
<p>The <code>format</code> field allows an application to change its snapshot format in a backwards-compatible manner by providing snapshots in multiple formats and choosing which formats to accept during restore.</p>
<p>This is useful, for example, when changing the serialization or compression format: as a node may be able to provide a snapshot to a node running an older version, or use an old snapshot when starting with a newer version.</p>
<p>The <code>hash</code> field contains an arbitrary snapshot hash. Snapshots with the same <code>metadata</code> fields (including <code>hash</code>) across nodes are considered to be the same, and <code>chunks</code> will be fetched from any of those nodes.</p>
<p>The <code>hash</code> is trustless and not verified by Tendermint itself, which prevents unintentional non-determinism in snapshot generation.</p>
<p><code>hash</code> can be verified by the application instead.</p>
<p>The <code>metadata</code> field can contain any arbitrary metadata required by the application.
For example, applications may wish to include block checksums to discard corrupt <code>chunks</code>, or <a href="https://ethereum.org/en/developers/tutorials/merkle-proofs-for-offline-data-integrity /">Merkle proofs</a> validates each block individually against the chain application hash.
Snapshot <code>metadata</code> messages cannot exceed 4 MB in <a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a> encoded form.</p>
<h3 id="take-and-provide-snapshots">Take and provide snapshots</h3>
<p>To enable state synchronization, certain nodes in the network must take and provide snapshots.
When a peer attempts a state sync, an existing Tendermint node will call the following ABCI method on the application to provide snapshot data to the peer:</p>
<ul>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#listsnapshots"><code>ListSnapshots</code></a>: Returns a list of available snapshots, along with metadata</li>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#loadsnapshotchunk"><code>LoadSnapshotChunk</code></a>: returns binary chunk data</li>
</ul>
<p>Snapshots should generally be generated periodically, rather than on-demand: this improves state synchronization performance, since snapshot generation can be slow, and avoids a denial-of-service vector for attackers flooding nodes with such requests.</p>
<p>Older snapshots can usually be deleted, but it may be useful to keep at least the two most recent snapshots to avoid deleting previous snapshots when the node recovers.</p>
<p>It is entirely up to the application to decide how to take a snapshot, but it should strive to meet the following guarantees:</p>
<ul>
<li><strong>async</strong>: Snapshot should not stop block processing, so it should happen asynchronously, eg. in a separate thread</li>
<li><strong>consistent</strong>: snapshots should be taken at isolated heights and should not be affected by concurrent writes, eg. Due to the block processing in the main thread</li>
<li><strong>Deterministic</strong>: For a given <code>height</code> and <code>format</code>, snapshot <code>chunks</code> and <code>metadata</code> should be the same (at byte level) for all nodes to ensure good availability of <code>chunks</code></li>
</ul>
<p>For example, this can be achieved as follows:</p>
<ol>
<li>Use a data store that supports transactions with snapshot isolation, such as RocksDB or BadgerDB.</li>
<li>Start a read-only database transaction in the main thread after the block is committed.</li>
<li>Pass the database transaction handle to the newly spawned thread.</li>
<li>Iterate over all data items in a definite order (for example, sort by key)</li>
<li>Serialize the data items (e.g. using <a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a>) and write them to a byte stream.</li>
<li>Hash the byte stream and split it into fixed size chunks (say 10 MB)</li>
<li>Store the chunks as separate files in the file system.</li>
<li>Write snapshot metadata to database or file, including byte stream hash.</li>
<li>Close the database transaction and exit the thread.</li>
</ol>
<p>Applications may also need to take additional steps, such as compressing data, validating blocks, generating proofs for incremental verification, and deleting old snapshots.</p>
<h3 id="restore-snapshot">restore snapshot</h3>
<p>When Tendermint starts, it checks to see if the local node has any state (i.e. whether <code>LastBlockHeight == 0</code>), and if not, it will start discovering snapshots over the P2P network.
These snapshots will be made available to native applications via the following ABCI calls:</p>
<ul>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#offersnapshot"><code>OfferSnapshot(snapshot, apphash)</code></a>: Offer a discovered snapshot to the application</li>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#applysnapshotchunk"><code>ApplySnapshotChunk(index, chunk, sender)</code></a>: apply snapshot chunk</li>
</ul>
<p>The discovered snapshot is provided to the application, which can respond by accepting the snapshot, rejecting the snapshot, rejecting the format, rejecting the sender, aborting the state synchronization, etc.</p>
<p>Once the snapshot is accepted, Tendermint will fetch blocks from available peers and apply them in order to the application, which can choose to accept blocks, refetch, reject snapshot, reject sender, abort state sync, etc.</p>
<p>After all blocks are applied, Tendermint will call the <a href="https://docs.tendermint.com/master/spec/abci/abci.html#info"><code>Info</code> ABCI method</a> on the application and check the application hash and The height corresponds to the trusted value in the chain.
It will then switch to fast sync for any remaining blocks (if enabled), before finally joining normal consensus operations.</p>
<p>How snapshots are actually restored is entirely up to the application, but usually the opposite of how they were generated.</p>
<p>Note, however, that Tendermint only verifies snapshots after all blocks have been restored, and will not reject any P2P peers on its own.</p>
<p>As long as the trusted hash and application code are correct, it is impossible for an adversary to cause a state-sync node to have an incorrect state when joining consensus, but applications can counteract state-sync denial of service (e.g., by implementing incremental verification, denying invalid node).</p>
<p>Note that state sync nodes will have a truncated block history from the height of the restored snapshot, there is currently no <a href="https://github.com/tendermint/tendermint/issues/4629">backfill of all block data</a>.
Networks should consider the wider implications and may wish to ensure that at least a few archiving nodes maintain full block history for auditability and backup purposes.</p>
<h2 id="cosmos-sdk-state-synchronization">Cosmos SDK state synchronization</h2>
<p><a href="https://github.com/cosmos/cosmos-sdk">Cosmos SDK</a> v0.40+ includes automatic support for state synchronization, so app developers just need to enable it to use. They will not need to implement the state sync protocol described in the <a href="#tendermint-core-state-sync">above section on Tendermint</a> themselves.</p>
<h3 id="state-synchronization-snapshot_1">State synchronization snapshot</h3>
<p>Tendermint Core handles most of the heavy lifting of discovering, exchanging, and validating state data for state synchronization, but applications must periodically take snapshots of their state, provide these snapshots to Tendermint via ABCI calls, and be able to resume these synchronizations when new nodes are created.</p>
<p>The Cosmos SDK stores application state in a data store called <a href="https://github.com/cosmos/iavl">IAVL</a>, and each module can set its own IAVL store.
At a fixed height interval (configurable), the Cosmos SDK will export the content of each store at that height, <a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a>-encode and compress it , and save it to the snapshot store on the local file system.
Since IAVL preserves historical versions of the data, these snapshots can be generated concurrently with the execution of new blocks.</p>
<p>Tendermint will fetch these snapshots via ABCI when a new node does a state sync.</p>
<p>Note that only IAVL storage managed by the Cosmos SDK can be snapshotted. If an app stores additional data in an external data store, there is currently no mechanism to include these in the state sync snapshot, so apps cannot use automatic state sync via the SDK.</p>
<p>However, as described in the <a href="https://docs.tendermint.com/master/spec/abci/apps.html#state-sync">ABCI documentation</a>, one is free to implement the state-sync protocol itself.</p>
<p>When a new node state syncs, Tendermint will take a snapshot from the peers in the network and serve it to the local (empty) application, which will import it into its IAVL storage.</p>
<p>Tendermint then verifies the app's application hash against the main blockchain using a light client validation and proceeds to execute blocks as usual.</p>
<p>Note that a state sync node will only restore the application state at the snapshot height and will not include historical data or historical blocks.</p>
<h3 id="enable-state-sync-snapshot">Enable state sync snapshot</h3>
<p>To enable state sync snapshots, an application using the CosmosSDK <code>BaseApp</code> needs to set up a snapshot store (with a database and a filesystem directory) and configure the snapshot interval and the number of historical snapshots to keep. A minimal example is as follows:</p>
<pre><code class="language-bash">snapshotDir := filepath.Join(
  cast.ToString(appOpts.Get(flags.FlagHome)), &quot;data&quot;, &quot;snapshots&quot;)
snapshotDB, err := sdk.NewLevelDB(&quot;metadata&quot;, snapshotDir)
if err != nil {
  panic(err)
}
snapshotStore, err := snapshots.NewStore(snapshotDB, snapshotDir)
if err != nil {
  panic(err)
}
app := baseapp.NewBaseApp(
  &quot;app&quot;, logger, db, txDecoder,
  baseapp.SetSnapshotStore(snapshotStore),
  baseapp.SetSnapshotInterval(cast.ToUint64(appOpts.Get(
    server.FlagStateSyncSnapshotInterval))),
  baseapp.SetSnapshotKeepRecent(cast.ToUint32(appOpts.Get(
    server.FlagStateSyncSnapshotKeepRecent))),
)
</code></pre>
<p>When the application is started with the appropriate flags, (e.g. <code>--state-sync.snapshot-interval 1000 --state-sync.snapshot-keep-recent 2</code>) it should take a snapshot and output a log message:</p>
<pre><code class="language-bash">Creating state snapshot module=main height=3000
Completed state snapshot module=main height=3000 format=1
</code></pre>
<p>Note that the snapshot interval must currently be a multiple of <code>pruning-keep-every</code> (default 100) to prevent height clipping when snapshots are taken. It's also usually a good idea to keep at least the 2 most recent snapshots, so that when a node tries to use it for state synchronization, previous snapshots are not deleted.</p>
<h2 id="state-synchronization-node">State synchronization node</h2>
<p>üì£ Tip: Looking for a snapshot or archive node to sync your nodes? Check out [this page].</p>
<p>Once several nodes in the network have taken state sync snapshots, new nodes can join the network using state sync.
To do this, the node should first be configured as usual, and the following information must be obtained for light client authentication:</p>
<ul>
<li>Two available RPC servers (at least)</li>
<li>Confidence height</li>
<li>Block ID hash with confidence height</li>
</ul>
<p>A trusted hash must be obtained from a trusted source (such as a block explorer), but the RPC server does not need to be trusted. Tendermint will use the hash to get the trusted application hash from the blockchain to verify the restored application snapshot. The application hash and corresponding height are the only information that can be trusted when restoring a snapshot. Everything else can be faked by an opponent.</p>
<p>In this guide we use Ubuntu 20.04</p>
<h3 id="prepare-the-system">Prepare the system</h3>
<p>update system</p>
<pre><code class="language-bash">sudo apt update -y
</code></pre>
<p>Upgrading the system</p>
<pre><code class="language-bash">sudo apt upgrade -y
</code></pre>
<p>install dependencies</p>
<pre><code class="language-bash">sudo apt-get install ca-certificates curl gnupg lsb-release make gcc git jq wget -y
</code></pre>
<p>Install Go</p>
<pre><code class="language-bash">wget -q -O - https://raw.githubusercontent.com/canha/golang-tools-install-script/master/goinstall.sh | bash
source ~/.bashrc
</code></pre>
<p>set node name</p>
<pre><code class="language-bash">moniker=&quot;NODE_NAME&quot;
</code></pre>
<h2 id="use-the-following-commands-for-mainnet-settings">Use the following commands for mainnet settings</h2>
<pre><code class="language-bash">SNAP_RPC1=&quot;http://xxx1:26657&quot;
SNAP_RPC=&quot;http://xxx:26657&quot;
CHAIN_ID=&quot;daodst_7777-1&quot;
PEER=&quot;96557e26aabf3b23e8ff5282d03196892a7776fc@xxx,dec587d55ff38827ebc6312cedda6085c59683b6@xxx&quot;
wget -O $HOME/genesis.json https://raw.githubusercontent.com/daodst/mainnet/genesis.json
</code></pre>
<h3 id="install-stcd">Install stcd</h3>
<pre><code class="language-bash">git clone https://github.com/daodst/blockchain.git &amp;&amp; \
cd cmd &amp;&amp; cd stcd
go build
</code></pre>
<h3 id="configuration">configuration</h3>
<p>node initialization</p>
<pre><code class="language-bash">stcd init $moniker --chain-id $CHAIN_ID
</code></pre>
<p>üì£ Tip: <code>$install_path</code> is used to indicate the path where you installed the <code>stcd</code> binary</p>
<p>Move the genesis file to the $install_path/.stcd/config folder</p>
<pre><code class="language-bash">mv $HOME/genesis.json $install_path/.stcd/config/
</code></pre>
<p>reset node</p>
<pre><code class="language-bash">stcd tendermint unsafe-reset-all --home .stcd
</code></pre>
<p>Change config file (set node name, add persistent peer, set indexer="null")</p>
<pre><code class="language-bash">sed -i -e &quot;s%^moniker *=.*%moniker = \&quot;$moniker\&quot;%; &quot; $install_path/.stcd/config/config.toml
sed -i -e &quot;s%^indexer *=.*%indexer = \&quot;null\&quot;%; &quot; $install_path/.stcd/config/config.toml
sed -i -e &quot;s%^persistent_peers *=.*%persistent_peers = \&quot;$PEER\&quot;%; &quot; $install_path/.stcd/config/config.toml
</code></pre>
<p>Set variables starting from snapshot</p>
<pre><code class="language-bash">LATEST_HEIGHT=$(curl -s $SNAP_RPC/block | jq -r .result.block.header.height); \
BLOCK_HEIGHT=$((LATEST_HEIGHT - 2000)); \
TRUST_HASH=$(curl -s &quot;$SNAP_RPC/block?height=$BLOCK_HEIGHT&quot; | jq -r .result.block_id.hash)
</code></pre>
<p>examine</p>
<pre><code class="language-bash">echo $LATEST_HEIGHT $BLOCK_HEIGHT $TRUST_HASH
</code></pre>
<p>Example output (numbers will vary):</p>
<pre><code class="language-bash">376080 374080 F0C78FD4AE4DB5E76A298206AE3C602FF30668C521D753BB7C435771AEA47189
</code></pre>
<p>If the output is normal, the next step</p>
<pre><code class="language-bash">sed -i.bak -E &quot;s|^(enable[[:space:]]+=[[:space:]]+).*$|\1true| ; \

s|^(rpc_servers[[:space:]]+=[[:space:]]+).*$|\1\&quot;$SNAP_RPC,$SNAP_RPC1\&quot;| ; \

s|^(trust_height[[:space:]]+=[[:space:]]+).*$|\1$BLOCK_HEIGHT| ; \

s|^(trust_hash[[:space:]]+=[[:space:]]+).*$|\1\&quot;$TRUST_HASH\&quot;| ; \

s|^(seeds[[:space:]]+=[[:space:]]+).*$|\1\&quot;\&quot;|&quot; $install_path/.stcd/config/config.toml
</code></pre>
<h3 id="create-stcd-service">Create stcd service</h3>
<pre><code class="language-bash">echo &quot;[Unit]
Description=Daodst Chain Node
After=network.target
#
[Service]
User=$USER
Type=simple
ExecStart=$(which stcd) daemon
Restart=on-failure
LimitNOFILE=65535
#
[Install]
WantedBy=multi-user.target&quot; &gt; $HOME/stcd.service; sudo mv $HOME/stcd.service /etc/systemd/system/
</code></pre>
<pre><code class="language-bash">sudo systemctl enable stcd.service &amp;&amp; sudo systemctl daemon-reload
</code></pre>
<h3 id="run-stcd">Run stcd</h3>
<pre><code class="language-bash">sytemctl start stcd
</code></pre>
<h3 id="check-logs">Check logs</h3>
<pre><code class="language-bash">journalctl -u stcd -f
</code></pre>
<p>When a node starts up, it will try to find a state sync snapshot in the network, and restore it:</p>
<pre><code class="language-bash">Started node module=main nodeInfo=&quot;...&quot;
Discovering snapshots for 20s
Discovered new snapshot height=3000 format=1 hash=0F14A473
Discovered new snapshot height=2000 format=1 hash=C6209AF7
Offering snapshot to ABCI app height=3000 format=1 hash=0F14A473
Snapshot accepted, restoring height=3000 format=1 hash=0F14A473
Fetching snapshot chunk height=3000 format=1 chunk=0 total=3
Fetching snapshot chunk height=3000 format=1 chunk=1 total=3
Fetching snapshot chunk height=3000 format=1 chunk=2 total=3
Applied snapshot chunk height=3000 format=1 chunk=0 total=3
Applied snapshot chunk height=3000 format=1 chunk=1 total=3
Applied snapshot chunk height=3000 format=1 chunk=2 total=3
Verified ABCI app height=3000 appHash=F7D66BC9
Snapshot restored height=3000 format=1 hash=0F14A473
Executed block height=3001 validTxs=16 invalidTxs=0
Committed state height=3001 txs=16 appHash=0FDBB0D5F
Executed block height=3002 validTxs=25 invalidTxs=0
Committed state height=3002 txs=25 appHash=40D12E4B3
</code></pre>
<p>Nodes are now in sync and join the network within seconds</p>
<h3 id="turn-off-state-synchronization-mode">Turn off state synchronization mode</h3>
<p>After the node is fully synced, use this command to turn off state sync mode to avoid problems with future node restarts!</p>
<pre><code class="language-bash">sed -i.bak -E &quot;s|^(enable[[:space:]]+=[[:space:]]+).*$|\1false|&quot; $install_path/.stcd/config/config.toml
</code></pre>
<p>‚ö†Ô∏è <strong>NOTE</strong>: The information contained in this document comes from <a href="https://medium.com/@erikgrinaker">Erik Grinaker</a>, in particular his state synchronization guide <a href="https://medium.com /tendermint/tendermint-core-state-sync-for-developers-70a96ba3ee35">Tendermint Core</a> and the <a href="https://medium.com/cosmos-blockchain/cosmos-sdk-state-sync-guide-99e4cf43be2f">Cosmos SDK</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
    
  </body>
</html>